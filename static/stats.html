<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>dRonin Stats</title>
    <link href="/static/stylesheets/nv.d3.css" rel="stylesheet" type="text/css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js" charset="utf-8"></script>
    <script src="//d3js.org/topojson.v1.min.js" charset="utf-8"></script>
    <script src="https://d3js.org/d3-queue.v2.min.js"></script>
    <script src="https://d3js.org/d3-collection.v0.1.min.js"></script>
    <script src="https://d3js.org/d3-dispatch.v0.2.min.js"></script>
    <script src="https://d3js.org/d3-dsv.v0.1.min.js"></script>
    <script src="https://d3js.org/d3-request.v0.3.min.js"></script>
    <script src="/static/lib/nv.d3.min.js"></script>

    <style>
      body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        width: 960px;
        margin: auto;
      }

      text {
        font: 10px sans-serif;
        stroke: none;
      }

      .axis path, .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }

      form {
        position: absolute;
        right: 10px;
        top: 10px;
      }

      div h2 {
        text-align: center;
      }

      #boards svg {
        height: 500px;
        width: 800px;
      }

      #oproc {
        float: right;
      }

      #oses svg {
        height: 200px;
        width: 300px;
      }

      #procs svg {
        height: 200px;
        width: 300px;
      }

      #versions svg {
        height: 450px;
        width: 500px;
      }

      #countries svg {
        height: 450px;
        width: 800px;
      }

      #countries-pop svg {
        height: 450px;
        width: 800px;
      }

      #countrymap {
        height: 450;
        width: 800;
      }

      #countrymap svg .land {
        fill: #ddd;
      }

      #countrymap rect.background {
        fill: #EBF4FA;
      }

      #countrymap svg .boundary {
        fill: none;
        stroke: #fff;
        stroke-width: .5px;
      }
    </style>
  </head>

  <body>
    <div id="charts">
      <div id="boards"><h2>Boards (<span id="totalboards">0</span> total)</h2><svg></svg></div>
      <div id="oproc">
        <div id="procs"><h2>Processors</h2><svg></svg></div>
        <div id="oses"><h2>OSes</h2><svg></svg></div>
      </div>
      <div id="versions"><h2>Versions</h2><svg></svg></div>
      <div id="countrymap"></div>
      <div id="countries"><h2>Top 20 Countries</h2><svg></svg></div>
      <div id="countries-pop"><h2>Top 20 Countries (normalized)</h2><svg></svg></div>
    </div>
  </body>

  <script src="/static/js/report.js"></script>
  <script lang="javascript">
    d3.tsv("/static/countries.tsv", function(error, data) {
      grokCountries(data);
    });
    d3.json("//dronin-autotown.appspot.com/api/usageStats", function(error, data) {
    if (error) return console.warn(error);
        var total = 0;
        d3.map(data['board']).forEach(function(k, v) { total += v; });
        d3.select("#totalboards").text(d3.format(",d")(total));
        drawBoardGraph(data);
        drawOSGraph(data);
        drawCountryGraph(data);
        drawCountryGraphNormalized(data);
        drawCountryMap(data);
        drawVersionGraph(data);
        drawProcessorGraph(data);
    });
  </script>
</html>
